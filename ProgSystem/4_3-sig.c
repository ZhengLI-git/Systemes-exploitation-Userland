/* 
 * Auteur(s):Zheng LI
 
 * Il émette un message numéro 1 ou un message numéro 2 sur réception du signal INT (lorsque l’on 
 * tape [Control-C]). Le choix du message émis se fait par commutation commandée par le signal 
 * QUIT (lorsque l’on tape [Control-\]).
 */

#include <signal.h>
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>

void (*sig_avant)(int);		/* pour la question 4.3 */

void hdl_quit(int sig){
  
  sig_avant = signal(SIGINT,sig_avant);//Mettre à jour les instructions de signal

}  
void hdl_int1(int sig){
  printf("message 1\n");

}
void hdl_int2(int sig){
  printf("message 2\n");

}


void travail() {
  /* Je travaille tres intensement !    */
  /* Ne cherchez pas a comprendre ;-) */
  /* Il n'y a rien a modifier ici     */
  const char msg[] = "-\\|/";
  const int sz = strlen(msg);
  int i = 0;

  for (;;) {
    write(STDOUT_FILENO, "\r", 1);
    usleep(100000);
    write(STDOUT_FILENO, " => ", 4);
    write(STDOUT_FILENO, &msg[i++], 1);
    if (i == sz) i = 0;
  }
}
void travail() __attribute__((noreturn));
/* Petit raffinement pour le compilateur: cette fonction ne termine pas */


int main() {
  sig_avant = hdl_int2;//Initialiser
  signal(SIGQUIT,hdl_quit);//Lors de la réception de SIGQUIT, commutez le signal
  signal(SIGINT,hdl_int1);//Lors de la réception de SIGINT, émettez les informations correspondantes

  printf("PID: %d\n", getpid());
  
  
  travail();
}
